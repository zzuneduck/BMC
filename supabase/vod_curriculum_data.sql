-- ============================================
-- VOD 커리큘럼 데이터 (안전한 마이그레이션)
-- - DROP TABLE 없음
-- - CREATE TABLE IF NOT EXISTS
-- - ALTER TABLE ... ADD COLUMN IF NOT EXISTS
-- - INSERT ... ON CONFLICT DO NOTHING
-- ============================================


-- ============================================
-- PART 1: 컬럼 추가 (없는 것만)
-- ============================================

-- vod_courses: week 컬럼
ALTER TABLE vod_courses ADD COLUMN IF NOT EXISTS week INTEGER;

-- vod_courses: is_published, published_at 컬럼
ALTER TABLE vod_courses ADD COLUMN IF NOT EXISTS is_published BOOLEAN DEFAULT true;
ALTER TABLE vod_courses ADD COLUMN IF NOT EXISTS published_at TIMESTAMPTZ;

-- vod_assignments: start_date, points, is_active 컬럼
ALTER TABLE vod_assignments ADD COLUMN IF NOT EXISTS start_date DATE;
ALTER TABLE vod_assignments ADD COLUMN IF NOT EXISTS points INTEGER DEFAULT 10;
ALTER TABLE vod_assignments ADD COLUMN IF NOT EXISTS is_active BOOLEAN DEFAULT true;

-- vod_progress: note 컬럼 (어려운 부분 메모)
ALTER TABLE vod_progress ADD COLUMN IF NOT EXISTS note TEXT;


-- ============================================
-- PART 2: title 기준 UNIQUE 제약 추가 (중복 방지)
-- ON CONFLICT 사용을 위해 필요
-- ============================================

-- vod_courses: title 유니크 (이미 있으면 무시)
DO $$
BEGIN
  IF NOT EXISTS (
    SELECT 1 FROM pg_constraint WHERE conname = 'vod_courses_title_key'
  ) THEN
    ALTER TABLE vod_courses ADD CONSTRAINT vod_courses_title_key UNIQUE (title);
  END IF;
END $$;

-- vod_assignments: week 유니크 (주차당 1개 숙제)
DO $$
BEGIN
  IF NOT EXISTS (
    SELECT 1 FROM pg_constraint WHERE conname = 'vod_assignments_week_key'
  ) THEN
    ALTER TABLE vod_assignments ADD CONSTRAINT vod_assignments_week_key UNIQUE (week);
  END IF;
END $$;


-- ============================================
-- PART 3: 기존 5개 강의 → week=1로 업데이트
-- ============================================

UPDATE vod_courses SET week = 1 WHERE week IS NULL;


-- ============================================
-- PART 4: 1주차 블로그 기본강의 01~28
-- ============================================

INSERT INTO vod_courses (week, title, course_type, category, order_num)
VALUES
(1, '블로그 강의 들을까 말까? 고민되면 먼저보세요', 'blog', '기본 강의', 1),
(1, '보편적 블로그 활용법 4가지', 'blog', '기본 강의', 2),
(1, '동적인 콘텐츠, 정적인 콘텐츠', 'blog', '기본 강의', 3),
(1, '블로그에 들어가는 리소스에 대해서', 'blog', '기본 강의', 4),
(1, '블로그 수익화, 지금도 가능할까?', 'blog', '기본 강의', 5),
(1, '블로그 운영 나이도에 대해서', 'blog', '기본 강의', 6),
(1, '블로그 운영에 소요되는 시간에 대해서', 'blog', '기본 강의', 7),
(1, '이 개념을 몰라서, 열심히 해도 제자리인겁니다.', 'blog', '기본 강의', 8),
(1, '가장 빠르게 체험단 가는 블로그 세팅 가이드', 'blog', '기본 강의', 9),
(1, '네이버 블로그 알아두면 좋은 용어 정리', 'blog', '기본 강의', 10),
(1, '빠르게 블로그 스킨 만들기 [자료, 템플릿 제공]', 'blog', '기본 강의', 11),
(1, '스마트에디터원 + 이미지', 'blog', '기본 강의', 12),
(1, '발행 개념에 대해서 제대로 알아야 합니다.', 'blog', '기본 강의', 13),
(1, '블로그 운영 팁 + 마인드셋', 'blog', '기본 강의', 14),
(1, '블로그 구독 시스템에 대해서', 'blog', '기본 강의', 15),
(1, '블로그 초보들이 자주 하는 실수 4가지', 'blog', '기본 강의', 16),
(1, '블로그 초보가 자주 하는 키워드 실수', 'blog', '기본 강의', 17),
(1, '저품질 블로그에 대해서', 'blog', '기본 강의', 18),
(1, '네이버 블로그 흐름, 맥락 파악하기', 'blog', '기본 강의', 19),
(1, '네이버 블로그 로직', 'blog', '기본 강의', 20),
(1, '네이버 블로그 로직 + 지수 + 글쓰기', 'blog', '기본 강의', 21),
(1, '키워드 찾는 방법', 'blog', '기본 강의', 22),
(1, '수익화 1단계', 'blog', '기본 강의', 23),
(1, '수익화 2단계', 'blog', '기본 강의', 24),
(1, '수익화 3단계', 'blog', '기본 강의', 25),
(1, '수익화 4단계', 'blog', '기본 강의', 26),
(1, '수익화 5단계', 'blog', '기본 강의', 27),
(1, '수익화 6단계', 'blog', '기본 강의', 28)
ON CONFLICT (title) DO NOTHING;


-- ============================================
-- PART 5: 2주차 블로그 기본강의 29~56
-- ============================================

INSERT INTO vod_courses (week, title, course_type, category, order_num)
VALUES
(2, '블로그 수익화, 이래서 실패합니다.', 'blog', '기본 강의', 29),
(2, '당신의 블로그가 안 되는 이유', 'blog', '기본 강의', 30),
(2, '네이버 베인은 어떻게 해야 노출될까?', 'blog', '기본 강의', 31),
(2, '키워드 [심화]', 'blog', '기본 강의', 32),
(2, '카테고리와 타겟', 'blog', '기본 강의', 33),
(2, '블로그 지수 디테일 ver. (미시적 관점)', 'blog', '기본 강의', 34),
(2, '블로그의 종류_1', 'blog', '기본 강의', 35),
(2, '블로그의 종류_2', 'blog', '기본 강의', 36),
(2, '어떤 블로그를 어떻게 운영해야 할까?', 'blog', '기본 강의', 37),
(2, '홈피드', 'blog', '기본 강의', 38),
(2, '생성형 AI 글쓰기_1', 'blog', '기본 강의', 39),
(2, '생성형 AI 글쓰기_2', 'blog', '기본 강의', 40),
(2, '생성형 AI 글쓰기_3', 'blog', '기본 강의', 41),
(2, '생성형 AI 글쓰기_4', 'blog', '기본 강의', 42),
(2, '생성형 AI 글쓰기_5', 'blog', '기본 강의', 43),
(2, '생성형 AI 글쓰기_6', 'blog', '기본 강의', 44),
(2, '새로운 안경, 네이버와 AI', 'blog', '기본 강의', 45),
(2, '검색과 광고', 'blog', '기본 강의', 46),
(2, '발견과 가치판단', 'blog', '기본 강의', 47),
(2, '네이버 블로그 거시적 흐름', 'blog', '기본 강의', 48),
(2, '창작자 콘텐츠 기획의 변화', 'blog', '기본 강의', 49),
(2, '홈피드 개념잡기', 'blog', '기본 강의', 50),
(2, '사용자 활동 기반 추천 원리', 'blog', '기본 강의', 51),
(2, '홈피드 추천 알고리즘', 'blog', '기본 강의', 52),
(2, '홈피드, 그럼 글쓰기는 어떻게 해야 할까?_1', 'blog', '기본 강의', 53),
(2, '홈피드, 그럼 글쓰기는 어떻게 해야 할까?_2', 'blog', '기본 강의', 54),
(2, '[실전] 팔리는 글쓰기_1', 'blog', '기본 강의', 55),
(2, '[실전] 팔리는 글쓰기_2', 'blog', '기본 강의', 56)
ON CONFLICT (title) DO NOTHING;


-- ============================================
-- PART 6: 2주차 별첨강의
-- ============================================

INSERT INTO vod_courses (week, title, course_type, category, order_num)
VALUES
(2, '[별첨] 네이버 알맹이 지수 관리하기 (편법)', 'blog', '별첨 강의', 1),
(2, '[별첨] 백링크', 'blog', '별첨 강의', 2),
(2, '[별첨] OSMU 원소스멀티유즈 권법', 'blog', '별첨 강의', 3),
(2, '[별첨] 스레드 강의', 'blog', '별첨 강의', 4),
(2, '[별첨] 사진 강의_기초', 'blog', '별첨 강의', 5),
(2, '[별첨] 브랜딩 강의_1', 'blog', '별첨 강의', 6),
(2, '[별첨] 브랜딩 강의_2', 'blog', '별첨 강의', 7),
(2, '[별첨] 브랜딩 강의_3', 'blog', '별첨 강의', 8),
(2, '[별첨] 브랜딩 강의_4', 'blog', '별첨 강의', 9)
ON CONFLICT (title) DO NOTHING;


-- ============================================
-- PART 7: 3주차 브랜드블로그 기본세팅 + 시작점
-- ============================================

INSERT INTO vod_courses (week, title, course_type, category, order_num)
VALUES
(3, '[기본세팅] 강사 소개_완전 기초부터 차근차근 알려드리겠습니다', 'brand', '브랜드블로그', 1),
(3, '[기본세팅] 첫 실전 경험, 첫 시장조사, 내 블로그 운영과는 달랐다', 'brand', '브랜드블로그', 2),
(3, '[기본세팅] 대행 하기 전, 반드시 알아야 할 내용', 'brand', '브랜드블로그', 3),
(3, '[기본세팅] 잘 된 블로그 vs 잘못된 블로그', 'brand', '브랜드블로그', 4),
(3, '[기본세팅] 업종 공부 어떻게 시작해야 하나요?', 'brand', '브랜드블로그', 5),
(3, '[기본세팅] 브랜드 블로그 업종별 난이도 (주관적)', 'brand', '브랜드블로그', 6),
(3, '[시작점] 브랜드 블로그의 시작점', 'brand', '브랜드블로그', 7),
(3, '[시작점] 키워드 툴, 블랙키위 활용하기', 'brand', '브랜드블로그', 8),
(3, '[시작점] [심화] 키워드 설계법, 검색되는 글의 시작', 'brand', '브랜드블로그', 9),
(3, '[시작점] 클릭률 2배 높이는 제목 짓는 법, 실전 키워드 팁', 'brand', '브랜드블로그', 10)
ON CONFLICT (title) DO NOTHING;


-- ============================================
-- PART 8: 4주차 브랜드블로그 실전 + 영업 + 운영 + 성장
-- ============================================

INSERT INTO vod_courses (week, title, course_type, category, order_num)
VALUES
-- 글쓰기실전
(4, '[글쓰기실전] 브랜드 블로그 글쓰기 기본', 'brand', '브랜드블로그', 1),
(4, '[글쓰기실전] 전문 지식 없이 전문가처럼 쓰는 법', 'brand', '브랜드블로그', 2),
(4, '[글쓰기실전] 고객이 저장하는 글 vs 스크롤 넘기는 글', 'brand', '브랜드블로그', 3),
(4, '[글쓰기실전] 의심을 확신으로 바꾸는 가치 입증 글', 'brand', '브랜드블로그', 4),
(4, '[글쓰기실전] 구매로 연결되는 글', 'brand', '브랜드블로그', 5),
(4, '[글쓰기실전] 관계 강화 글쓰기 (스토리텔링)', 'brand', '브랜드블로그', 6),
(4, '[글쓰기실전] 돈 되는 글 + 주제 발굴 팁', 'brand', '브랜드블로그', 7),
-- 영업과시스템
(4, '[영업과시스템] 주도적으로 고객을 여는 방법', 'brand', '브랜드블로그', 8),
(4, '[영업과시스템] 인바운드_고객이 먼저 찾아오게 만드는 구조', 'brand', '브랜드블로그', 9),
(4, '[영업과시스템] 상품 구성과 가격 설정 노하우', 'brand', '브랜드블로그', 10),
(4, '[영업과시스템] 아웃바운드와 인바운드의 장단점 (+주관적 생각)', 'brand', '브랜드블로그', 11),
(4, '[영업과시스템] 가격을 말하지 않고 가격을 설득하는 법', 'brand', '브랜드블로그', 12),
-- 운영과재계약
(4, '[운영과재계약] 클라이언트와 일하는 법_계약부터 확장까지', 'brand', '브랜드블로그', 13),
(4, '[운영과재계약] 첫 미팅 시 사용하는 질문 리스트', 'brand', '브랜드블로그', 14),
(4, '[운영과재계약] 제안서 없이 제안하는 대화법', 'brand', '브랜드블로그', 15),
(4, '[운영과재계약] 계약 시 주의사항 & 리스크를 피하기 위한 가이드라인', 'brand', '브랜드블로그', 16),
(4, '[운영과재계약] 재계약을 유도하는 블로그 운영 루틴', 'brand', '브랜드블로그', 17),
(4, '[운영과재계약] 영업 마인드셋', 'brand', '브랜드블로그', 18),
-- 수익화와성장전략
(4, '[수익화와성장전략] 0원에서 월 300, 1인 대행으로 성장하는 길', 'brand', '브랜드블로그', 19),
(4, '[수익화와성장전략] 수익화 단계별 성장 이야기', 'brand', '브랜드블로그', 20),
(4, '[수익화와성장전략] 글쓰기 시간을 줄이고 효율을 높이는 루틴', 'brand', '브랜드블로그', 21),
(4, '[수익화와성장전략] 장기 운영을 위한 마인드셋 & 소통법', 'brand', '브랜드블로그', 22),
(4, '[수익화와성장전략] 1인 대행사 망하지 않으려면 반드시 지켜야 하는 운영 원칙', 'brand', '브랜드블로그', 23)
ON CONFLICT (title) DO NOTHING;


-- ============================================
-- PART 9: VOD 숙제 4주차 (주차별 1개씩)
-- ============================================

INSERT INTO vod_assignments (week, title, description, start_date, due_date, points, is_active)
VALUES
(1, '1주차 VOD 숙제 - 블로그 기본강의 01~28',
 '블로그 기본강의 01~28번까지 시청하고 핵심 내용을 정리해주세요.
실습 URL과 궁금한 점도 함께 제출해주세요.',
 '2025-02-02', '2025-02-08', 10, true),

(2, '2주차 VOD 숙제 - 블로그 기본강의 29~56 + 별첨',
 '블로그 기본강의 29~56번과 별첨강의를 시청하고 핵심 내용을 정리해주세요.
실습 URL과 궁금한 점도 함께 제출해주세요.',
 '2025-02-09', '2025-02-15', 10, true),

(3, '3주차 VOD 숙제 - 브랜드블로그 기본세팅 + 시작점',
 '브랜드블로그 기본세팅과 시작점 강의를 시청하고 핵심 내용을 정리해주세요.
실습 URL과 궁금한 점도 함께 제출해주세요.',
 '2025-02-16', '2025-02-22', 10, true),

(4, '4주차 VOD 숙제 - 브랜드블로그 실전 + 영업 + 운영 + 성장',
 '브랜드블로그 글쓰기실전, 영업, 운영, 성장전략 강의를 시청하고 핵심 내용을 정리해주세요.
실습 URL과 궁금한 점도 함께 제출해주세요.',
 '2025-02-23', '2025-03-01', 10, true)
ON CONFLICT (week) DO NOTHING;


-- ============================================
-- PART 10: 결과 확인
-- ============================================

SELECT 'vod_courses: ' || COUNT(*) || '개' AS result FROM vod_courses;
SELECT 'vod_assignments: ' || COUNT(*) || '개' AS result FROM vod_assignments;
SELECT '주차별 강의 수:' AS info;
SELECT week, COUNT(*) AS count FROM vod_courses GROUP BY week ORDER BY week;
